# This chart catches changes and then pushed to main branch
# Tests, Updates Dependency and Packages, then pushes to 
# our parent repo that holds all Helx Charts Helm-Charts
# Used by Appstore-charts and Helx-Charts

name: Trigger-Helm-Charts
on:
  workflow_call:
    secrets:
      env_vars:
        required: true
    # inputs:
    #   appRepo:
    #     description: 'ðŸ›‘ NOT FOR MANUAL USE!!! Repo of the newly updated Helm Chart.'
    #     required: true
    #     type: string
    #   actor:
    #     description: 'The username who caused the update to helm-charts on another repo'
    #     required: true
    #     type: string
jobs:
  trigger-helm-charts:
    env:
      env_vars: ${{ secrets.env_vars }}
    runs-on: ubuntu-latest
    steps:
    - name: Decode credentials as environment variables
      run: |
        for i in $env_vars; do
          i=$(echo $i | sed 's/=.*//g')=$(echo ${i#*=} | base64 -di | base64 -di)
          echo ::add-mask::${i#*=}
          printf '%s\n' "$i" >> $GITHUB_ENV
        done
    - name: Trigger Helm-Charts Workflow
      env: 
        GH_TOKEN: ${{ github.token }}
      run: | 
        gh --repo https://github.com/pchachicho/helm-charts-actions \
        workflow run package-index.yml \
        -f appRepo=${{ env.APPREPO }} \
        -f actor=${{ env.ACTOR }} \
        --ref develop


    

        - name: Decode credentials as environment variables
        run: |
          for i in $env_vars; do
            i=$(echo $i | sed 's/=.*//g')=$(echo ${i#*=} | base64 -di | base64 -di)
            echo ::add-mask::${i#*=}
            printf '%s\n' "$i" >> $GITHUB_ENV
          done